<style>
    /* 폼 컨테이너 */
    .apply-container {
        max-width: 800px;
        margin: 60px auto 100px;
        padding: 0 20px;
    }

    .apply-title {
        text-align: center;
        margin-bottom: 50px;
    }

    .apply-title h2 {
        font-size: 36px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .apply-title p {
        font-size: 16px;
        color: #666;
    }

    /* 폼 스타일 */
    .apply-form {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        padding: 40px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group>label {
        display: block;
        font-size: 15px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
    }

    .form-group input[type="text"],
    .form-group input[type="tel"],
    .form-group input[type="email"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
        box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #03552d;
    }

    .form-group textarea {
        min-height: 120px;
        resize: vertical;
    }

    .form-hint {
        font-size: 13px;
        color: #888;
        margin-top: 6px;
    }

    /* 생년월일 그룹 */
    .birth-date-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .birth-date-group select {
        flex: 1;
        min-width: 100px;
        padding: 14px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
    }

    /* 연락처 그룹 */
    .phone-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .phone-group select,
    .phone-group input {
        padding: 14px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        text-align: center;
    }

    .phone-group select {
        width: 100px;
    }

    .phone-group input {
        width: 100px;
    }

    .phone-group span {
        color: #666;
        font-size: 18px;
    }

    /* 라디오 버튼 그룹 */
    .radio-group {
        display: flex;
        gap: 25px;
        margin-top: 10px;
        flex-wrap: wrap;
    }

    .radio-label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        font-weight: 400;
    }

    .radio-label input[type="radio"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .radio-label span {
        font-size: 15px;
        color: #333;
    }

    /* 개인정보 동의 */
    .privacy-section {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 25px;
        margin-top: 30px;
    }

    .privacy-section h4 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
    }

    .privacy-content {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        max-height: 200px;
        overflow-y: auto;
        font-size: 13px;
        line-height: 1.8;
        color: #555;
        margin-bottom: 15px;
    }

    .privacy-content h5 {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        margin: 15px 0 8px;
    }

    .privacy-content h5:first-child {
        margin-top: 0;
    }

    .privacy-agree {
        display: flex;
        gap: 20px;
        margin-top: 15px;
    }

    /* 제출 버튼 */
    .btn-submit-wrap {
        text-align: center;
        margin-top: 40px;
    }

    .btn-submit {
        display: inline-block;
        padding: 16px 60px;
        background: linear-gradient(135deg, #03552d 0%, #047a3e 100%);
        color: #fff !important;
        font-size: 17px;
        font-weight: 600;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        text-decoration: none !important;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(3, 85, 45, 0.3);
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(3, 85, 45, 0.4);
    }

    /* 닫기 버튼 */
    .close-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: #fff;
        border: 2px solid #ddd;
        border-radius: 50%;
        font-size: 24px;
        color: #666;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
    }

    .close-btn:hover {
        background: #f5f5f5;
        border-color: #ccc;
        color: #333;
    }

    /* 카페24 기본 입력 필드 숨김 */
    .cafe24-hidden {
        display: none !important;
    }

    /* 반응형 */
    @media (max-width: 768px) {
        .apply-container {
            margin: 40px auto 60px;
        }

        .apply-form {
            padding: 25px 20px;
        }

        .apply-title h2 {
            font-size: 28px;
        }

        .radio-group {
            gap: 15px;
        }

        .phone-group {
            flex-wrap: wrap;
        }

        .phone-group select,
        .phone-group input {
            flex: 1;
            min-width: 80px;
        }
    }
</style>

<div module="Mall_Urgencycall">
    <!-- 닫기 버튼 -->
    <button class="close-btn" onclick="closeWindow()" title="닫기">&times;</button>

    <div class="apply-container">
        <div class="apply-title">
            <h2>참여신청서</h2>
            <p>노인일자리 사업 참여를 신청합니다</p>
        </div>

        <div class="apply-form">
            <!-- 참여희망 사업명 -->
            <div class="form-group">
                <label>참여희망 사업명 <span style="color: #e74c3c;">*</span></label>
                {$form.question}
            </div>

            <!-- 이름 (커스텀) -->
            <div class="form-group">
                <label>이름 <span style="color: #e74c3c;">*</span></label>
                <input type="text" id="customName" name="customName" placeholder="이름을 입력해주세요" required>
            </div>
            <!-- 카페24 이름 필드 숨김 -->
            <div class="cafe24-hidden">{$form.writer}</div>

            <!-- 연락처 (3칸 분리) -->
            <div class="form-group">
                <label>연락처 <span style="color: #e74c3c;">*</span></label>
                <div class="phone-group">
                    <input type="text" id="phone1" value="010" readonly style="background: #f5f5f5; cursor: default;">
                    <span>-</span>
                    <input type="text" id="phone2" maxlength="4" placeholder="1234">
                    <span>-</span>
                    <input type="text" id="phone3" maxlength="4" placeholder="5678">
                </div>
                <!-- 카페24 연락처 필드 숨김 -->
                <div class="cafe24-hidden">{$form.mobile}</div>
            </div>

            <!-- 생년월일 -->
            <div class="form-group">
                <label>생년월일 <span style="color: #e74c3c;">*</span></label>
                <div class="birth-date-group">
                    <select id="birthYear" required>
                        <option value="">년도</option>
                        <script>
                            for (let y = new Date().getFullYear() - 50; y >= 1930; y--) {
                                document.write('<option value="' + y + '">' + y + '년</option>');
                            }
                        </script>
                    </select>
                    <select id="birthMonth" required>
                        <option value="">월</option>
                        <option value="1">1월</option>
                        <option value="2">2월</option>
                        <option value="3">3월</option>
                        <option value="4">4월</option>
                        <option value="5">5월</option>
                        <option value="6">6월</option>
                        <option value="7">7월</option>
                        <option value="8">8월</option>
                        <option value="9">9월</option>
                        <option value="10">10월</option>
                        <option value="11">11월</option>
                        <option value="12">12월</option>
                    </select>
                    <select id="birthDay" required>
                        <option value="">일</option>
                        <script>
                            for (let d = 1; d <= 31; d++) {
                                document.write('<option value="' + d + '">' + d + '일</option>');
                            }
                        </script>
                    </select>
                </div>
            </div>
            <!-- 카페24 나이 필드 숨김 (생년월일 데이터로 대체) -->
            <div class="cafe24-hidden">{$form.title}</div>

            <!-- 기초생활 수급자 여부 -->
            <div class="form-group">
                <label>기초생활 수급자 여부 <span style="color: #e74c3c;">*</span></label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="basicLiving" value="해당" required>
                        <span>해당</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="basicLiving" value="비해당">
                        <span>비해당</span>
                    </label>
                </div>
            </div>

            <!-- 기초연금 수급자 여부 -->
            <div class="form-group">
                <label>기초연금 수급자 여부 <span style="color: #e74c3c;">*</span></label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="basicPension" value="수급" required>
                        <span>수급</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="basicPension" value="미수급">
                        <span>미수급</span>
                    </label>
                </div>
            </div>

            <!-- 차상위계층 해당 유무 -->
            <div class="form-group">
                <label>차상위계층 해당 유무 <span style="color: #e74c3c;">*</span></label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="nearPoverty" value="해당" required>
                        <span>해당</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="nearPoverty" value="비해당">
                        <span>비해당</span>
                    </label>
                </div>
            </div>

            <!-- 남기실 말씀 -->
            <div class="form-group">
                <label>남기실 말씀</label>
                {$form.content}
                <p class="form-hint">기타 문의사항이 있으시면 작성해주세요.</p>
            </div>

            <!-- 개인정보 동의 -->
            <div class="privacy-section">
                <h4>개인정보 수집 및 이용 동의 <span style="color: #e74c3c;">*</span></h4>
                <div class="privacy-content">
                    <p>'부산강서시니어클럽'(이하 '기관')은 참여 신청자의 개인정보를 중요시하며, "정보통신망 이용촉진 및 정보보호에 관한 법률"을 준수하고 있습니다.</p>

                    <h5>수집하는 개인정보 항목</h5>
                    <p>기관은 노인일자리 사업 참여 신청을 위해 아래와 같은 개인정보를 수집합니다.</p>
                    <p><strong>수집항목:</strong> 이름, 연락처(휴대전화번호), 생년월일, 참여희망 사업명, 수급자 여부, 기타 문의사항</p>
                    <p><strong>수집방법:</strong> 홈페이지 참여신청서</p>

                    <h5>개인정보의 수집 및 이용목적</h5>
                    <p>- 노인일자리 사업 참여 신청 접수 및 처리</p>
                    <p>- 참여자 본인 확인 및 연락</p>
                    <p>- 사업 안내 및 필요한 고지사항 전달</p>

                    <h5>개인정보의 보유 및 이용기간</h5>
                    <p>참여신청서는 접수 후 <strong>1년간 보관</strong>하며, 보관 기간이 경과하면 지체 없이 파기합니다.</p>

                    <h5>개인정보 관련 문의</h5>
                    <p><strong>부산강서시니어클럽</strong></p>
                    <p>- 전화번호: 051) 973-1167</p>
                    <p>- 이메일: kss20150101@hanmail.net</p>
                </div>
                <div class="privacy-agree">
                    <label class="radio-label">
                        <input type="radio" name="privacyAgree" value="agree" id="privacyAgreeYes" required>
                        <span>동의함</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="privacyAgree" value="disagree" id="privacyAgreeNo">
                        <span>동의안함</span>
                    </label>
                </div>
            </div>

            <!-- 숨겨진 카페24 기본 제출 버튼 -->
            <div style="display: none;">
                <a href="#none" onclick="{$action_send}" id="cafe24Submit">제출</a>
            </div>

            <!-- 제출 버튼 -->
            <div class="btn-submit-wrap">
                <a href="#none" onclick="validateAndSubmit(); return false;" class="btn-submit">참여신청서 등록</a>
            </div>
        </div>
    </div>
</div>

<script>
    // 유효성 검사 및 데이터 통합
    function validateAndSubmit() {
        var errors = [];

        // 이름 검사
        var name = document.getElementById('customName').value.trim();
        if (!name) {
            errors.push('이름을 입력해주세요.');
        } else if (!/^[가-힣]{2,7}$/.test(name)) {
            errors.push('이름은 한글 2~7자로 입력해주세요.');
        }

        // 연락처 검사
        var phone1 = document.getElementById('phone1').value;
        var phone2 = document.getElementById('phone2').value.trim();
        var phone3 = document.getElementById('phone3').value.trim();

        if (!phone2 || !phone3) {
            errors.push('연락처를 입력해주세요.');
        } else if (!/^\d{3,4}$/.test(phone2) || !/^\d{4}$/.test(phone3)) {
            errors.push('연락처를 올바르게 입력해주세요.');
        }

        // 생년월일 검사
        var birthYear = document.getElementById('birthYear').value;
        var birthMonth = document.getElementById('birthMonth').value;
        var birthDay = document.getElementById('birthDay').value;
        if (!birthYear || !birthMonth || !birthDay) {
            errors.push('생년월일을 선택해주세요.');
        }

        // 수급자 여부 검사
        if (!document.querySelector('input[name="basicLiving"]:checked')) {
            errors.push('기초생활 수급자 여부를 선택해주세요.');
        }
        if (!document.querySelector('input[name="basicPension"]:checked')) {
            errors.push('기초연금 수급자 여부를 선택해주세요.');
        }
        if (!document.querySelector('input[name="nearPoverty"]:checked')) {
            errors.push('차상위계층 해당 유무를 선택해주세요.');
        }

        // 개인정보 동의 검사
        var privacyAgree = document.querySelector('input[name="privacyAgree"]:checked');
        if (!privacyAgree) {
            errors.push('개인정보 수집 및 이용 동의를 선택해주세요.');
        } else if (privacyAgree.value === 'disagree') {
            errors.push('개인정보 수집 및 이용에 동의해야 신청이 가능합니다.');
        }

        // 에러가 있으면 표시
        if (errors.length > 0) {
            alert('다음 항목을 확인해주세요:\n\n' + errors.join('\n'));
            return false;
        }

        // 카페24 숨겨진 필드에 데이터 입력
        // 이름 필드 설정
        var writerInputs = document.querySelectorAll('input[name="writer"], input[id*="writer"]');
        writerInputs.forEach(function (input) {
            input.value = name;
        });

        // 연락처 필드 설정 (병합)
        var fullPhone = phone1 + '-' + phone2 + '-' + phone3;
        var mobileInputs = document.querySelectorAll('input[name="mobile"], input[id*="mobile"]');
        mobileInputs.forEach(function (input) {
            input.value = fullPhone;
        });

        // 생년월일 필드 설정
        var titleInputs = document.querySelectorAll('input[name="title"], input[id*="title"]');
        var birthDate = birthYear + '년 ' + birthMonth + '월 ' + birthDay + '일생';
        titleInputs.forEach(function (input) {
            input.value = birthDate;
        });

        // 내용 필드에 추가 정보 병합
        var contentArea = document.querySelector('textarea[name="content"], textarea[id*="content"]');
        if (contentArea) {
            var basicLiving = document.querySelector('input[name="basicLiving"]:checked').value;
            var basicPension = document.querySelector('input[name="basicPension"]:checked').value;
            var nearPoverty = document.querySelector('input[name="nearPoverty"]:checked').value;

            var extraInfo = '\n\n--- 추가 정보 ---\n';
            extraInfo += '기초생활 수급자 여부: ' + basicLiving + '\n';
            extraInfo += '기초연금 수급자 여부: ' + basicPension + '\n';
            extraInfo += '차상위계층 해당 유무: ' + nearPoverty;

            contentArea.value = contentArea.value + extraInfo;
        }

        // 성공 메시지 표시
        alert('등록이 완료되었습니다.');

        // 카페24 기본 제출 버튼 클릭
        var cafe24SubmitBtn = document.getElementById('cafe24Submit');
        if (cafe24SubmitBtn) {
            cafe24SubmitBtn.click();
        }

        // 0.1초 후 창 닫기
        setTimeout(function () {
            window.close();
        }, 100);
    }

    // 동의안함 선택시 경고
    document.getElementById('privacyAgreeNo').addEventListener('change', function () {
        if (this.checked) {
            alert('개인정보 수집 및 이용에 동의하셔야 참여신청이 가능합니다.');
            document.getElementById('privacyAgreeYes').checked = true;
        }
    });

    // 닫기 버튼 함수
    function closeWindow() {
        if (window.opener) {
            window.close();
        } else {
            window.location.href = 'https://2026.gs2015.kr/';
        }
    }
</script>